<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/maincss.css">
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
        <script type="text/javascript" src="js/jquery-3.6.0.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
        <link rel="icon" href="Imagen/Logo.png">
        <title>EduMaking-CRM - Instructores</title>
    </head>
    <body>
        <div class="cuerpoCompleto" display= "flex" justify-content= "center">
            <header>
                <div class="cabeza">
                    <img src="Imagen/logoEslogan1.png" >
                </div>
            </header>
            <div id="menuPpal">
                <menu-Ppal name-File = "Instructor.html"></menu-Ppal>
            </div>
            <div class="contenido" id="contenido-Instr">
              <div class="form">
                <div class="tab-content">
                    <div class="col-md">
                        <br/>
                    </div>
                    <div class="card" id="card-tblInstructores">
                        <div class="boton">
                          <a class="btn btn-info" href="instructor-crear.html" role="button">Crear Instructor</a>
                        </div>
                        <h3> </h3>
                        <h5 class="card-header rounded-top d-flex justify-content-center">Listado de Instructores</h5>
                        <div class="card-body">
                        <table class="table table-primary table-striped table-hover" name="tblInstructores">
                            <thead>
                                <tr>
                                    <th scope="col" id="col1">Id. Instructor</th>
                                    <th scope="col" id="col2">Nombre</th>
                                    <th scope="col" id="col3">Telefonos</th>
                                    <th scope="col" id="col4">Email</th>
                                    <th scope="col" id="col5">Profesión</th>
                                    <th scope="col" id="col6">Inicio Experiencia</th>
                                    <th scope="col" id="col7">País</th>
                                    <th scope="col" id="col8">Ciudad</th>
                                    <th scope="col" id="col9">Estado</th>
                                    <th scope="col" colspan="2" id="col10">Opciones</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                            <tfoot class="table-primary">
                            </tfoot>
                        </table>
                        </div> <!-- /card-body-->
                    </div> <!-- /card-->
                </div><!-- tab-content -->
            </div> <!-- /form -->
            </div> <!-- /contenido -->
            <footer>
                <div id="footer_wrapper">
                    <div id="footer">
                        Copyright © 2021 <a href="#">EduMaking</a> - Design: <a href="#">Grupo 7</a>
                    </div> <!-- end of footer -->
            </div> 
            </footer>
            <!-------------------------------------------------------------------------------------------->
            <div id="modalInstructor" class="modal fade" tabindex="-1" aria-labelledby="ModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header bg-primary text-white">
                            <h5 class="modal-title" id="ModalLabel">Modificación de Instructor</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="http://localhost:8080/api/instructores" method="POST"  id="frmModal">
//////////////////////////////////////////////////////////////////////
                                <div class="row">
                                    <div class="col-12 col-sm-4 mb-3">
                                        <label for="cedula">Cédula<span class="req">*</span></label>
                                        <input type="text" id="cedula" name="cedula" required autocomplete="off" class="form-control" tabindex="1">
                                    </div>
                                    <div class="col-12 col-sm-8 mb-3">
                                        <label for="nombre">Nombre del Instructor<span class="req">*</span></label>
                                        <input type="text" id="nombre" name="nombre" required autocomplete="off" class="form-control" tabindex="2">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12 col-sm-6 mb-3">
                                        <label for="telefono">Teléfono<span class="req">*</span></label>
                                        <input type="phone" id="telefono" name="telefono" required autocomplete="off" class="form-control">
                                    </div>
                                    <div class="col-12 col-sm-6 mb-3">
                                        <label for="correo">Correo Electrónico<span class="req">*</span></label>
                                        <input type="email" id="correo" name="correo" required autocomplete="off" class="form-control">
                                    </div>
                                </div>

                                <div class="mb-3">
                                <label for="profesion">Profesion<span class="req">*</span></label>
                                <select name="profesion" id="profesion" class="form-select">
                                  <option value="">Seleccione...</option>
                                  <option value="IngenieroCivil">Ingeniero civil</option>
                                  <option value="IngenieroPetroleos">Ingeniero de Petroleos</option>
                                  <option value="IngenieroHidrico">Ingeniero de recursos hídricos y gestión ambiental</option>
                                </select>
                                </div>

                                <div class="mb-3">
                                <label for="experiencia">Incluya la experiencia laboral del instructor.<span class="req">*</span></label>
                                <input type="text" id="experiencia" name="experiencia" required autocomplete="off" class="form-control">
                                </div>

                                <div class="row">
                                <div class="col-12 col-sm-6 mb-3">
                                    <label for="pais">Pais<span class="req">*</span></label>
                                    <select name="pais" id="pais" class="form-select">
                                      <option value="">Seleccione...</option>
                                      <option value="Colombia">Cololmbia</option>
                                      <option value="España">España</option>
                                    </select>
                                </div>

                                <div class="col-12 col-sm-6 mb-3">
                                    <label for="ciudad">ciudad<span class="req">*</span></label>
                                      <select name="ciudad" id="ciudad" class="form-select">
                                        <option value="">Seleccione...</option>
                                        <option value="Bucaramanga">Bucaramanga</option>
                                        <option value="Barrancabermeja">Barrancabermeja</option>
                                        <option value="Bogota">Bogotá</option>
                                        <option value="Madrid">Madrid</option>
                                      </select>
                                </div>

                                <label for="estado">Estado<span class="req">*</span></label>
                                <!-- este es un campo de seleccion tal como lo he PAIS y CIUDAD  --ANDERSON-->  
                                <select name="estado" id="estado" class="form-select">
                                    <option value="">Seleccione...</option>
                                    <option value="Activo">Activo</option>
                                    <option value="Inactivo">Inactivo</option>
                                </select>

                              </div>

//////////////////////////////////////////////////////////////////////
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-primary">Actualizar</button>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!--------------------------------------------------------------------------------------------->
        <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
        <script src="js/app.js"></script>
        <script src = "js/crudInscr.js" type = "module"></script>
        
        <script>
            /* Obtengo el nombre del instructor */
            function runScriptInstr(e) {
                //let objSelCurso = document.getElementById('nombrecurso');
                let idCurso = document.getElementById('nombrecurso').value;
                let idInstr = '';
                
                // Con el id del curso, busco el dato del id del intructor
                const API_URL_CURSO = '//localhost:8080/api/cursos/' + idCurso

                fetch(`${API_URL_CURSO}`)
                    .then(response => response.json())
                    .then(data => document.getElementById('nombreinstructor').value = data.instructor.nombre)
                    .catch(error => console.log(error))
            }

            /* Obtengo el nombre del Estudiante */
            function runScriptEstud(e) {
                let ObjEstud = document.getElementById('idestudiante');
                let IdEstud = ObjEstud.value;
                const URL_ID_ESTUD = '//localhost:8080/api/personas/' + IdEstud;

                fetch(`${URL_ID_ESTUD}`)
                    .then(response => response.json())
                    .then(data => document.getElementById('nomestudiante').value = data.nombrePersona)
                    .catch(error => console.log(error))
            }

            /*function resetForm() {
                const FORM_MODAL = document.getElementById("frmModal");
                FORM_MODAL.reset();
            }*/

        
            /* Actualizamos los datos de inscrip. del formulario modal */
            const FORM_MODAL = document.getElementById("frmModal");
            FORM_MODAL.addEventListener('submit', (e)=>{
                e.preventDefault()
                const MODAL_INSCR = new bootstrap.Modal(document.getElementById('modalInscripcion'))
                let idInscr = document.getElementById('idInscr').value;
                const API_URL_INSCR = '//localhost:8080/api/inscripciones/actualizar/' + idInscr;
                let modalFormData = new FormData(FORM_MODAL);

                const objUpd = {
                    "curso": {
                        "id": modalFormData.get("nombrecurso")
                    },
                    "persona": {
                        "idPersona": modalFormData.get("idestudiante")
                    },
                    "fechaIni": modalFormData.get("finicio"),
                    "fechaFin": modalFormData.get("ffin"),
                    "certificado": modalFormData.get("estadocertif")
                };

                fetch(`${API_URL_INSCR}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type':'application/json'
                    },
                    body: JSON.stringify(objUpd)
                })
                .then((res) => {
                    res.json();
                    swal({
                        title: "INFORMACIÓN",
                        text: "La inscripción se actualizó exitosamente.",
                        type: "success"
                    }).then(function() {
                        MODAL_INSCR.hide();
                        location.reload();
                    });
                    
                })
                .catch((error) => console.error("Error:", error));
            })

        </script>
    </body>
</html>