<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/maincss.css">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/jquery-3.6.0.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <link rel="icon" href="Imagen/Logo.png">
  <title>EduMaking-CRM - Contacto Persona</title>
</head>

<body>
  <div class="cuerpoCompleto" display="flex" justify-content="center">
    <header>
      <div class="cabeza">
        <img src="Imagen/logoEslogan1.png">
      </div>
    </header>
    <div id="menuPpal">
      <menu-Ppal name-File="Contactos Persona.html"></menu-Ppal>
    </div>
    <div class="contenido">
      <div class="form">

        <div class="tab-content">
          <h1> </h1>

          <form action="http://localhost:8080/api/personas" method="POST" id="frmPersonas">

            <div class="card">
              <h5 class="card-header rounded-top d-flex justify-content-center">Contacto Persona</h5>
              <div class="card-body">
                <div class="row">
                  <div class="col-12 col-sm-6 mb-3">
                    <label for="cedula">Cedula<span class="req">*</span></label>
                    <input type="text" id="cedula" name="cedula" required class="form-control" autocomplete="on"
                      placeholder="Ingrese documento">
                  </div>
                  <div class="col-12 col-sm-6 mb-3">
                    <label for="tipodoc">Tipo Documento</label>
                    <select name="tipodoc" id="tipodoc" class="form-select">
                      <option value="">Seleccione...</option>
                      <option value="cc">CC</option>
                      <option value="ce">CE</option>
                      <option value="nit">NIT</option>
                      <option value="nitcc">NITCC</option>
                      <option value="regciv">REGCIV</option>
                      <option value="ti">TI</option>
                    </select>
                  </div>
                  <div class="col-12 col-sm-6 mb-3">
                    <label for="nombreempresa">Nombre Empresa<span class="req">*</span></label>
                    <input type="text" id="nombrempresa" name="nombrempresa" required class="form-control" placeholder="Ingrese el nombre">
                  </div>
                  <div class="col-12 col-sm-6 mb-3">
                    <label for="teleemp">Telefono Empresa<span class="req">*</span></label>
                    <input type="text" id="teleemp" name="teleemp" class="form-control" required autocomplete="on" placeholder="Ingrese el teléfono" />
                  </div>
                </div>

                <div class="row">

                  <div class="col-12 col-sm-6 mb-3">
                    <label for="correo">Correo Empresa<span class="req">*</span></label>
                    <input type="email" id="correoemp" name="correoemp" class="form-control" required autocomplete="off" placeholder="Ingrese el correo" />
                  </div>
                  <div class="col-12 col-sm-6 mb-3">
                    <label for="persona|">Nombre Persona<span class="req">*</span></label>
                    <input type="persona" id="nombrepersona" name="nombrepersona" class="form-control" required autocomplete="off"
                      placeholder="Ingrese el nombre" />
                  </div>
                </div>

                <div class="row">
                  <div class="col-12 col-sm-6 mb-3">
                    <label for="teleper">Telefono Persona<span class="req">*</span></label>
                    <input type="text" id="teleper" name="teleper" class="form-control" required autocomplete="on" placeholder="Ingrese el teléfono" />
                  </div>
                  <div class="col-12 col-sm-6 mb-3">
                    <label for="correoper">Correo Persona<span class="req">*</span></label>
                    <input type="email" id="correoper" name="correoper" class="form-control" required autocomplete="off" placeholder="Ingrese el correo" />
                  </div>
                </div>

                <div class="row">
                  <div class="col-12 col-sm-6 mb-3">
                    <label for="cargo">Cargo</label>
                    <input type="text" id="cargo" name="cargo" class="form-control" autocomplete="on" placeholder="Ingrese el cargo" />
                  </div>
                  <div class="col-12 col-sm-6 mb-3">
                    <label for="profesion">Profesión<span class="req">*</span></label>
                    <select name="profesion" id="profesion" class="form-select">
                      <option value="">Seleccione...</option>
                    </select>
                  </div>
                </div>

                <div class="row">
                  <div class="col-12 col-sm-6 mb-3">
                    <label>Clasificación<span class="req">*</span></label>
                    <select name="clasificacion" id="clasificacion" class="form-select">
                      <option value="">Seleccione...</option>
                      <option value="clienteant">Cliente Antiguo</option>
                      <option value="clientenew">Cliente nuevo</option>
                      <option value="Lead">Prospecto</option>
                    </select>
                  </div>
                  <div class="col-12 col-sm-6 mb-3">
                    <label for="pais">Pais<span class="req">*</span></label>
                    <select name="pais" id="pais" class="form-select" onchange="getCiudades()">
                      <option value="">Seleccione...</option>
                    </select>
                  </div>
                </div>

                <div class="row">

                  <div class="col-12 col-sm-6 mb-3">
                    <label for="ciudad">Ciudad<span class="req">*</span></label>
                    <select name="ciudad" id="ciudad" class="form-select">
                        <option value="">Seleccione...</option>
                    </select>
                  </div>
                  <div class="col-12 col-sm-6 mb-3">
                    <label for="rut">Rut<span class="req">*</span></label>
                    <input type="text" name="rut" id="rut" class="form-control" required autocomplete="on" placeholder="Ingrese el rut" />
                  </div>

                </div>


                <div class="row">
                  <div class="col-12 col-sm-12 mb-3">
                    <label for="intereses" class="form-label">Intereses<span class="req">*</span></label>
                    <textarea class="form-control" id="intereses" name="intereses" rows="3" required></textarea>
                  </div>
                </div>

                <div class="row">
                  <div class="col-12 col-sm-3 mb-3">
                    <label>Estado del contacto<span class="req">*</span></label>
                    <select name="estado" id="estado" class="form-select">
                      <option value="A">Activo</option>
                      <option value="I">Inactivo</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="boton col-sm-8">
                    <button type="submit" class="btn btn-primary">Registrar</button>
                  </div>
                  <div class="boton col-sm-4">
                    <a class="btn btn-info" href="Contactos Persona.html" role="button">Volver al Listado</a>
                  </div>
                </div>
              </div> <!-- CARD-BODY cerramos clase CARD-BODY de los botones  --ANDERSON-->
            </div>

          </form>

        </div><!-- tab-content -->

      </div> <!-- /form -->
    </div>
    <footer>
      <div id="footer_wrapper">
        <div id="footer">
          Copyright © 2021 <a href="#">EduMaking</a> - Design: <a href="#">Grupo 7</a>
        </div> <!-- end of footer -->
      </div>
    </footer>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <script src="js/app.js"></script>

  <script>
    /* Obtener datos para llenar el select de profesiones */
    const API_URL_PROFESIONES = '//localhost:8080/api/profesiones';

    fetch(`${API_URL_PROFESIONES + '/listar'}`)
      .then(response => response.json())
      .then(data => fillProfesion(data))
      .catch(error => console.log(error))

    function fillProfesion(profJson) {
      for (let prof of profJson) {
        let newOption = document.createElement("option");
        newOption.value = prof.id;
        newOption.text = prof.nombre;
        profesion.add(newOption);
      }
    }


    /* Obtener datos para llenar el select de paises */
    const OBJ_PAIS = document.getElementById('pais');
    const API_URL_PAISES = '//localhost:8080/api/paises';

    fetch(`${API_URL_PAISES + '/listar'}`)
      .then(response => response.json())
      .then(data => fillCiudad(data))
      .catch(error => console.log(error))

    function fillCiudad(instrJson) {
      for (let instr of instrJson) {
        let newOption = document.createElement("option");
        newOption.value = instr.id;
        newOption.text = instr.nombre;
        OBJ_PAIS.add(newOption);
      }
    }


    /* Obtenemos las ciudades del pais seleccionado */
    function getCiudades() {
      const API_URL_CIUDADES = '//localhost:8080/api/ciudades';
      const OBJ_CIUDAD = document.getElementById('ciudad');

      let idPais = pais.value;
      ciudad.options.length = 0;
      let newOption = document.createElement("option");
      newOption.value = "";
      newOption.text = "Seleccione...";
      OBJ_CIUDAD.add(newOption);

      fetch(`${API_URL_CIUDADES + '/listar'}`)
        .then(response => response.json())
        .then(data => fillCiudades(data))
        .catch(error => console.log(error))

      function fillCiudades(ciudadesJson) {
          for (let ciudad of ciudadesJson) {
              if (idPais == ciudad.pais.id) {
                let newOption = document.createElement("option");
                newOption.value = ciudad.idciudad;
                newOption.text = ciudad.nombre;
                OBJ_CIUDAD.add(newOption);
              }
          }
      }
    }


    /* Guardamos los datos del formulario */
    const API_URL_PERSONAS = '//localhost:8080/api/personas/'
    const FORM_PERSONAS = document.getElementById("frmPersonas");

    FORM_PERSONAS.addEventListener("submit", function (event) {
      event.preventDefault();
      let transactionFormData = new FormData(FORM_PERSONAS);

      const obj = {
        "idPersona": transactionFormData.get("cedula"),
        "tipoDoc": transactionFormData.get("tipodoc"),
        "nombreEmpresa": transactionFormData.get("nombrempresa"),
        "telEmpresa": transactionFormData.get("teleemp"),
        "emailEmpresa": transactionFormData.get("correoemp"),
        "nombrePersona": transactionFormData.get("nombrepersona"),
        "telPersona": transactionFormData.get("teleper"),
        "emailPersona": transactionFormData.get("correoper"),
        "cargoPersona": transactionFormData.get("cargo"),
        "profesion": {
          "id": transactionFormData.get("profesion")
        },
        "clasif": transactionFormData.get("clasificacion"),
        "pais": {
          "id": transactionFormData.get("pais")
        },
        "ciudad": {
          "idciudad": transactionFormData.get("ciudad")
        },
        "rutPersona": transactionFormData.get("rut"),
        "interes": transactionFormData.get("intereses"),
        "estado": transactionFormData.get("estado")
      };

      fetch(`${API_URL_PERSONAS}`, {
        method: "POST",
        body: JSON.stringify(obj),
        headers: {
          "Content-Type": "application/json",
        },
      })
        .then((res) => {
          res.json();
          swal({
            title: "INFORMACIÓN",
            text: "La persona se grabó exitosamente.",
            type: "success"
          }).then(function () {
            FORM_PERSONAS.reset();
            codigo.focus();
          });

        })
        .catch((error) => console.error("Error:", error));
    })

  </script>
</body>

</html>